{"ast":null,"code":"var _jsxFileName = \"/mnt/c/Nicholas/Programming/Fullstack/fullstack/Osa8/library-frontend/src/App.js\";\nimport React, { useState, useEffect } from 'react';\nimport Authors from './components/Authors';\nimport Books from './components/Books';\nimport NewBook from './components/NewBook';\nimport LoginForm from './components/LoginForm';\nimport Recommend from './components/Recommend';\nimport { useQuery, useApolloClient, useSubscription } from '@apollo/client';\nimport { ALL_AUTHORS, ALL_BOOKS, BOOK_ADDED } from './queries';\n\nconst Notify = ({\n  errorMessage\n}) => {\n  if (!errorMessage) {\n    return null;\n  }\n\n  return React.createElement(\"div\", {\n    style: {\n      color: 'red'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 16\n    },\n    __self: this\n  }, errorMessage);\n};\n\nconst App = () => {\n  const [page, setPage] = useState('authors');\n  const allAuthors = useQuery(ALL_AUTHORS);\n  const [authors, setAuthors] = useState([]);\n  const [token, setToken] = useState(null);\n  const [errorMessage, setErrorMessage] = useState(null);\n  const client = useApolloClient();\n  console.log(allAuthors.data, 'allAuthors.data in App.js');\n\n  const updateCacheWith = addedBook => {\n    console.log(addedBook, 'addedBook in updateCacheWith in App.js');\n    console.log(addedBook._id, 'addedBook.id in updateCacheWith in App.js');\n\n    const includedIn = (set, object) => set.map(b => b._id).includes(object._id);\n\n    const dataInStore = client.readQuery({\n      query: ALL_BOOKS\n    });\n    console.log(dataInStore, 'dataInStore in App.js');\n    console.log(dataInStore.allBooks, 'dataInStore in App.js');\n\n    if (!includedIn(dataInStore.allBooks, addedBook)) {\n      client.writeQuery({\n        query: ALL_BOOKS,\n        data: {\n          allBooks: dataInStore.allBooks.concat(addedBook)\n        }\n      });\n    }\n  };\n\n  useSubscription(BOOK_ADDED, {\n    onSubscriptionData: ({\n      subscriptionData\n    }) => {\n      const addedBook = subscriptionData.data.bookAdded;\n      console.log(subscriptionData.data, 'subscriptionData.data in NewBook.js');\n      window.alert(addedBook.title + ' added');\n      updateCacheWith(addedBook);\n    }\n  });\n  useEffect(() => {\n    const token = localStorage.getItem('phonenumbers-user-token');\n\n    if (token) {\n      setToken(token);\n    }\n  }, []);\n  useEffect(() => {\n    if (allAuthors.data) {\n      console.log(allAuthors.data.allAuthors, 'allAuthors.data.allAuthors in App.js');\n      setAuthors(allAuthors.data.allAuthors);\n    }\n  }, [allAuthors]);\n\n  const logout = () => {\n    setToken(null);\n    localStorage.clear();\n    client.resetStore();\n    setPage('login');\n  };\n\n  const notify = message => {\n    setErrorMessage(message);\n    setTimeout(() => {\n      setErrorMessage(null);\n    }, 5000);\n  };\n\n  if (!token) {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: () => setPage('authors'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, \"authors\"), React.createElement(\"button\", {\n      onClick: () => setPage('books'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }, \"books\"), React.createElement(\"button\", {\n      onClick: () => setPage('login'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, \"login\")), React.createElement(Notify, {\n      errorMessage: errorMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }), React.createElement(LoginForm, {\n      setToken: setToken,\n      setPage: setPage,\n      setError: notify,\n      show: page === 'login',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }), React.createElement(Authors, {\n      token: token,\n      authors: authors,\n      show: page === 'authors',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }), React.createElement(Books, {\n      show: page === 'books',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    }));\n  }\n\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    onClick: () => setPage('authors'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, \"authors\"), React.createElement(\"button\", {\n    onClick: () => setPage('books'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, \"books\"), React.createElement(\"button\", {\n    onClick: () => setPage('add'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, \"add book\"), React.createElement(\"button\", {\n    onClick: () => setPage('recommend'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, \"recommend\"), React.createElement(\"button\", {\n    onClick: logout,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, \"logout\")), React.createElement(Notify, {\n    errorMessage: errorMessage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }), React.createElement(Authors, {\n    token: token,\n    authors: authors,\n    show: page === 'authors',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }), React.createElement(Books, {\n    show: page === 'books',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }), React.createElement(NewBook, {\n    token: token,\n    show: page === 'add',\n    updateCacheWith: updateCacheWith,\n    setErrorMessage: setErrorMessage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }), React.createElement(Recommend, {\n    token: token,\n    show: page === 'recommend',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }));\n};\n\nexport default App;","map":{"version":3,"sources":["/mnt/c/Nicholas/Programming/Fullstack/fullstack/Osa8/library-frontend/src/App.js"],"names":["React","useState","useEffect","Authors","Books","NewBook","LoginForm","Recommend","useQuery","useApolloClient","useSubscription","ALL_AUTHORS","ALL_BOOKS","BOOK_ADDED","Notify","errorMessage","color","App","page","setPage","allAuthors","authors","setAuthors","token","setToken","setErrorMessage","client","console","log","data","updateCacheWith","addedBook","_id","includedIn","set","object","map","b","includes","dataInStore","readQuery","query","allBooks","writeQuery","concat","onSubscriptionData","subscriptionData","bookAdded","window","alert","title","localStorage","getItem","logout","clear","resetStore","notify","message","setTimeout"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport Authors from './components/Authors'\nimport Books from './components/Books'\nimport NewBook from './components/NewBook'\nimport LoginForm from './components/LoginForm'\nimport Recommend from './components/Recommend'\nimport { useQuery, useApolloClient, useSubscription } from '@apollo/client'\nimport { ALL_AUTHORS, ALL_BOOKS, BOOK_ADDED } from './queries'\n\nconst Notify = ({ errorMessage }) => {\n  if ( !errorMessage ) {\n    return null\n  }\n\n  return (\n    <div style={{color: 'red'}}>\n      {errorMessage}\n    </div>\n  )\n}\n\nconst App = () => {\n  const [page, setPage] = useState('authors')\n  const allAuthors = useQuery(ALL_AUTHORS)\n  const [authors, setAuthors] = useState([])\n  const [token, setToken] = useState(null)\n  const [errorMessage, setErrorMessage] = useState(null)\n  const client = useApolloClient()\n\n  console.log(allAuthors.data, 'allAuthors.data in App.js')\n\n  const updateCacheWith = (addedBook) => {\n    console.log(addedBook, 'addedBook in updateCacheWith in App.js')\n    console.log(addedBook._id, 'addedBook.id in updateCacheWith in App.js')\n    const includedIn = (set, object) => \n      set.map(b => b._id).includes(object._id)  \n\n    const dataInStore = client.readQuery({ query: ALL_BOOKS })\n    console.log(dataInStore, 'dataInStore in App.js')\n    console.log(dataInStore.allBooks, 'dataInStore in App.js')\n    if (!includedIn(dataInStore.allBooks, addedBook)) {\n      client.writeQuery({\n        query: ALL_BOOKS,\n        data: { allBooks : dataInStore.allBooks.concat(addedBook) }\n      })\n    }\n  }\n\n  useSubscription(BOOK_ADDED, {\n    onSubscriptionData: ({ subscriptionData }) => {\n      const addedBook = subscriptionData.data.bookAdded\n      console.log(subscriptionData.data, 'subscriptionData.data in NewBook.js')\n      window.alert(addedBook.title + ' added')\n      updateCacheWith(addedBook)\n    }\n  })\n\n  useEffect(() => {\n    const token = localStorage.getItem('phonenumbers-user-token')\n    if ( token ) {\n      setToken(token)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (allAuthors.data) {\n      console.log(allAuthors.data.allAuthors, 'allAuthors.data.allAuthors in App.js')\n      setAuthors(allAuthors.data.allAuthors)\n    }\n  }, [allAuthors])\n\n  const logout = () => {\n    setToken(null)\n    localStorage.clear()\n    client.resetStore()\n    setPage('login')\n  }\n\n  const notify = (message) => {\n    setErrorMessage(message)\n    setTimeout(() => {\n      setErrorMessage(null)\n    }, 5000)\n  }\n\n  if (!token) {\n    return (\n      <div>\n        <div>\n        <button onClick={() => setPage('authors')}>authors</button>\n        <button onClick={() => setPage('books')}>books</button>\n        <button onClick={() => setPage('login')}>login</button>\n        </div>\n\n        <Notify errorMessage={errorMessage} />\n\n        <LoginForm\n          setToken={setToken}\n          setPage={setPage}\n          setError={notify}\n          show={page === 'login'}\n        />\n\n        <Authors token={token} \n          authors={authors}\n          show={page === 'authors'}\n        />\n\n        <Books show={page === 'books'} />\n        \n      </div>\n    )\n  }\n\n  return (\n    <div>\n      <div>\n        <button onClick={() => setPage('authors')}>authors</button>\n        <button onClick={() => setPage('books')}>books</button>\n        <button onClick={() => setPage('add')}>add book</button>\n        <button onClick={() => setPage('recommend')}>recommend</button>\n        <button onClick={logout}>logout</button>\n      </div>\n\n      <Notify errorMessage={errorMessage} />\n\n      <Authors token={token} \n        authors={authors}\n        show={page === 'authors'}\n      />\n\n      <Books show={page === 'books'} />\n\n      <NewBook\n        token={token}\n        show={page === 'add'}\n        updateCacheWith={updateCacheWith}\n        setErrorMessage={setErrorMessage}\n      />\n\n      <Recommend\n        token={token}\n        show={page === 'recommend'}\n      />\n\n    </div>\n  )\n}\n\nexport default App"]},"metadata":{},"sourceType":"module"}